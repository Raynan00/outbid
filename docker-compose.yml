services:
  # 3 Cloudflare Bypass Servers with different proxies for fingerprint rotation
  cloudflare_bypass_1:
    image: ghcr.io/sarperavci/cloudflarebypassforscraping:latest
    container_name: cloudflare_bypass_1
    restart: unless-stopped
    ports:
      - "8001:8000"
    environment:
      - PROXY_URL=${PROXY_URL_1:-}
    networks:
      - outbid_network
    deploy:
      resources:
        limits:
          memory: 800M

  cloudflare_bypass_2:
    image: ghcr.io/sarperavci/cloudflarebypassforscraping:latest
    container_name: cloudflare_bypass_2
    restart: unless-stopped
    ports:
      - "8002:8000"
    environment:
      - PROXY_URL=${PROXY_URL_2:-}
    networks:
      - outbid_network
    deploy:
      resources:
        limits:
          memory: 800M

  cloudflare_bypass_3:
    image: ghcr.io/sarperavci/cloudflarebypassforscraping:latest
    container_name: cloudflare_bypass_3
    restart: unless-stopped
    ports:
      - "8003:8000"
    environment:
      - PROXY_URL=${PROXY_URL_3:-}
    networks:
      - outbid_network
    deploy:
      resources:
        limits:
          memory: 800M

  outbid_bot:
    build: .
    container_name: outbid_bot
    restart: always
    depends_on:
      - cloudflare_bypass_1
      - cloudflare_bypass_2
      - cloudflare_bypass_3
    env_file:
      - .env
    environment:
      - DISPLAY=:99
      - CLOUDFLARE_BYPASS_URLS=http://cloudflare_bypass_1:8000,http://cloudflare_bypass_2:8000,http://cloudflare_bypass_3:8000
      - DATABASE_PATH=/app/data/upwork_bot.db
    volumes:
      - ./data:/app/data
    networks:
      - outbid_network
    deploy:
      resources:
        limits:
          memory: 2G

  # Webhook Server for Payment Confirmations (Paystack/Stripe)
  webhook_server:
    build: .
    container_name: outbid_webhooks
    restart: always
    command: ["python", "webhook_server.py"]
    env_file:
      - .env
    environment:
      - DATABASE_PATH=/app/data/upwork_bot.db
    ports:
      - "5000:5000"  # Expose webhook port
    volumes:
      - ./data:/app/data
    networks:
      - outbid_network
    deploy:
      resources:
        limits:
          memory: 512M

networks:
  outbid_network:
    driver: bridge
